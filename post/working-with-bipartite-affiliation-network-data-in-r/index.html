<!DOCTYPE html>
<!-- This site was created with Hugo Blox. https://hugoblox.com -->
<!-- Last Published: February 4, 2026 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Hugo Blox Builder 5.9.7" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.5adeb309104bf059bfce5194cee5d4d8.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  






<script async src="https://www.googletagmanager.com/gtag/js?id=G-9XTZZP2CJ8"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'G-9XTZZP2CJ8', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>
























  
  
  






  <meta name="author" content="Sol Messing" />





  

<meta name="description" content="Data can often be usefully conceptualized in terms affiliations between people (or other key data entities). It might be useful analyze common group membership, common purchasing decisions, or common patterns of behavior. This post introduces bipartite/affiliation network data and provides R code to help you process and visualize this kind of data. I recently updated this for use with larger data sets, though I put it together a while back.
" />



<link rel="alternate" hreflang="en-us" href="https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/" />
<link rel="canonical" href="https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu_b6b141330a993e2f.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu_bdf5fe8f122b026c.png" />

<meta name="theme-color" content="#1565c0" />










  






<meta property="twitter:card" content="summary_large_image" />

  <meta property="twitter:site" content="@SolomonMg" />
  <meta property="twitter:creator" content="@SolomonMg" />
<meta property="twitter:image" content="https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/featured.jpg" />



  

<meta property="og:type" content="article" />
<meta property="og:site_name" content="Sol Messing" />
<meta property="og:url" content="https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/" />
<meta property="og:title" content="Working with Bipartite/Affiliation Network Data in R | Sol Messing" />
<meta property="og:description" content="Data can often be usefully conceptualized in terms affiliations between people (or other key data entities). It might be useful analyze common group membership, common purchasing decisions, or common patterns of behavior. This post introduces bipartite/affiliation network data and provides R code to help you process and visualize this kind of data. I recently updated this for use with larger data sets, though I put it together a while back." /><meta property="og:image" content="https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/featured.jpg" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2012-03-04T00:00:00&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2020-05-12T00:00:00&#43;00:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/"
  },
  "headline": "Working with Bipartite/Affiliation Network Data in R",
  
  "image": [
    "https://solmessing.netlify.app/post/working-with-bipartite-affiliation-network-data-in-r/featured.jpg"
  ],
  
  "datePublished": "2012-03-04T00:00:00Z",
  "dateModified": "2020-05-12T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Sol Messing"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Sol Messing",
    "logo": {
      "@type": "ImageObject",
      "url": "https://solmessing.netlify.app/media/icon_hu_3baeddb697bfad35.png"
    }
  },
  "description": "\u003cp\u003eData can often be usefully conceptualized in terms affiliations between people (or other key data entities). It might be useful analyze common group membership, common purchasing decisions, or common patterns of behavior. This post introduces bipartite/affiliation network data and provides R code to help you process and visualize this kind of data. I recently updated this for use with larger data sets, though I put it together a while back.\u003c/p\u003e"
}
</script>

  

  




  
  
  

  
  

  


  
  <title>Working with Bipartite/Affiliation Network Data in R | Sol Messing</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="d65b13c16e4dbae2ab430dcb587674fd" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.9e4214442a7711d35691acd58f6f6361.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Sol Messing</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Sol Messing</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#featured"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#media"><span>Media</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#mybio"><span>Bio</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/techsetup/"><span>Tech Stack</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/disclosures/"><span>Disclosures</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/pdf/CV/CV.pdf"><span>CV</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  






















  
  



<div class="article-container pt-3">
  <h1>Working with Bipartite/Affiliation Network Data in R</h1>

  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  <span >
      Sol Messing</span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    May 12, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    17 min read
  </span>
  

  
  
  
  

  
  

</div>

  




<div class="btn-links mb-3">
  
  








  









  
    
  











</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 672px; max-height: 672px;">
  <div style="position: relative">
    <img src="/post/working-with-bipartite-affiliation-network-data-in-r/featured_hu_84fe32a6d23732af.webp" width="672" height="672" alt="" class="featured-image">
    <span class="article-header-caption">Network diagram of bipartite graph</span>
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>Data can often be usefully conceptualized in terms affiliations between people (or other key data entities). It might be useful analyze common group membership, common purchasing decisions, or common patterns of behavior. This post introduces bipartite/affiliation network data and provides R code to help you process and visualize this kind of data. I recently updated this for use with larger data sets, though I put it together a while back.</p>
<h2 id="preliminaries">Preliminaries</h2>
<p>Much of the material here is covered in the more comprehensive <a href="http://sna.stanford.edu/rlabs.php" target="_blank" rel="noopener">&ldquo;Social Network Analysis Labs in R and SoNIA,&rdquo;</a> on which I collaborated with Dan McFarland, Sean Westwood and Mike Nowak.
For a great online introduction to social network analysis see the online book <a href="http://www.faculty.ucr.edu/~hanneman/nettext/" target="_blank" rel="noopener">Introduction to Social Network Methods</a> by Robert Hanneman and Mark Riddle.</p>
<h2 id="bipartiteaffiliation-network-data">Bipartite/Affiliation Network Data</h2>
<p>A network can consist of different &lsquo;classes&rsquo; of nodes. For example, a two-mode network might consist of people (the first mode) and groups in which they are members (the second mode). Another very common example of two-mode network data consists of users on a particular website who communicate in the same forum thread.
Here&rsquo;s a short example of this kind of data. Run this in R for yourself - just copy an paste into the command line or into a script and it will generate a dataframe that we can use for illustrative purposes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">    <span class="n">person</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;Sam&#39;</span><span class="p">,</span><span class="s">&#39;Sam&#39;</span><span class="p">,</span><span class="s">&#39;Sam&#39;</span><span class="p">,</span><span class="s">&#39;Greg&#39;</span><span class="p">,</span><span class="s">&#39;Tom&#39;</span><span class="p">,</span><span class="s">&#39;Tom&#39;</span><span class="p">,</span><span class="s">&#39;Tom&#39;</span><span class="p">,</span><span class="s">&#39;Mary&#39;</span><span class="p">,</span><span class="s">&#39;Mary&#39;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">group</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;d&#39;</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">stringsAsFactors</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">person</span> <span class="n">group</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span>    <span class="n">Sam</span>     <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="m">2</span>    <span class="n">Sam</span>     <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="m">3</span>    <span class="n">Sam</span>     <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="m">4</span>   <span class="n">Greg</span>     <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="m">5</span>    <span class="n">Tom</span>     <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="m">6</span>    <span class="n">Tom</span>     <span class="n">c</span>
</span></span><span class="line"><span class="cl"><span class="m">7</span>    <span class="n">Tom</span>     <span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="m">8</span>   <span class="n">Mary</span>     <span class="n">b</span>
</span></span><span class="line"><span class="cl"><span class="m">9</span>   <span class="n">Mary</span>     <span class="n">d</span>
</span></span></code></pre></div><h2 id="c1">Fast, efficient two-mode to one-mode conversion in R</h2>
<p>Suppose we wish to analyze or visualize how the people are connected directly - that is, what if we want the network of people where a tie between two people is present if they are both members of the same group? We need to perform a two-mode to one-mode conversion.</p>
<p>To convert a two-mode incidence matrix to a one-mode adjacency matrix, one can simply multiply an incidence matrix by its transpose, which sum the common 1&rsquo;s between rows. Recall that matrix multiplication entails multiplying the k-th entry of a row in the first matrix by the k-th entry of a column in the second matrix, then summing, such that the ij-th row-column entry in resulting matrix represents the dot-product of the i-th row of the first matrix and the j-th column of the second. In mathematical notation:</p>
<p>$$
AB = \left [
\begin{array}{cc}
a &amp; b  \\\
c &amp; d
\end{array} \right ]
\left [ \begin{array}{cc}
e &amp; f  \\\
g &amp; h
\end{array} \right ] =
\left [
\begin{array}{cc}
ae+bg &amp; af+bh \\\
ce+dg &amp; cf+dh
\end{array}
\right ]
$$</p>
<p>Notice further that multiplying a matrix by its transpose yields the following:</p>
<p>$$
\begin{align}
AA&rsquo; =
\left[
\begin{array}{cc}
a &amp; b  \\\
c &amp; d
\end{array}
\right]
\left[
\begin{array}{cc}
a &amp; c  \\\
b &amp; d
\end{array}
\right] =
\left[
\begin{array}{cc}
aa+bb &amp; ac+bd \\\
ca+db &amp; cc+dd
\end{array}
\right]
\end{align}
$$</p>
<p>Because our incidence matrix consists of 0&rsquo;s and 1&rsquo;s, the off-diagonal entries represent the total number of common columns, which is exactly what we wanted. We&rsquo;ll use the <code>%*%</code> operator to tell R to do exactly this. Let&rsquo;s take a look at a small example using toy data of people and groups to which they belong. We&rsquo;ll coerce the data to an incidence matrix, then multiply the incidence matrix by its transpose to get the number of common groups between people.</p>
<p>This is easy to do using the matrix algebra functions included in R. But first, you need to restructure your (edgelist) network data as an incidence matrix. An incidence will record a 1 for row-column combinations where a tie is present and 0 otherwise. One easy way to do this in R is to use the table function and then coerce the table object to a matrix object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">table</span><span class="p">(</span> <span class="n">df</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span> <span class="n">m</span> <span class="p">)</span>
</span></span></code></pre></div><p>If you are using the network or sna packages, a network object be coerced via <code>as.matrix(your-network)</code>; with the igraph package use <code>get.adjacency(your-network)</code>.</p>
<p>This is great, but what about if we are working with a really large data set? Network data is almost always sparse&mdash;there are far more pairwise combinations of potential connections than actual observed connections. Hence, we&rsquo;d actually prefer to keep the underlying data structured in edgelist format, but we&rsquo;d also like access to R&rsquo;s matrix algebra functionality.</p>
<p>We can get the best of both worlds using the Matrix library to construct a sparse triplet representation of a matrix. But we&rsquo;d also like to avoid building the entire incidence matrix and just feed Matrix our edgelist directly, a point that came up in a recent conversation I had with <a href="http://seanjtaylor.com/" target="_blank" rel="noopener">Sean Taylor</a>. We feed <code>Matrix</code> our &lsquo;person&rsquo; column to index &lsquo;i&rsquo; (rows in the new incidence matrix), our &lsquo;group&rsquo; column to index j (columns in the new incidence matrix), and we repeat &lsquo;1&rsquo; for the length of the edgelist to denote an incidence.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="s">&#39;Matrix&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="o">&lt;-</span> <span class="nf">spMatrix</span><span class="p">(</span><span class="n">nrow</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"><span class="n">ncol</span><span class="o">=</span><span class="nf">length</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">group</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"><span class="n">j</span> <span class="o">=</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">group</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">)))</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">row.names</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">levels</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">person</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">colnames</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">levels</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">group</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span>
</span></span></code></pre></div><p>We will either convert to the &lsquo;mode&rsquo; represented by the columns or by the rows.
To get the one-mode representation of ties between rows (people in our example), multiply the matrix by its transpose. Note that you must use the matrix-multiplication operator <code>%*%</code> rather than a simple astrisk. The R code is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Arow</span> <span class="o">&lt;-</span> <span class="n">A</span> <span class="o">%*%</span> <span class="nf">t</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span></span></code></pre></div><p>But we can still do better! The function tcrossprod is faster and more efficient for this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Arow</span> <span class="o">&lt;-</span> <span class="nf">tcrossprod</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span></span></code></pre></div><p>Arow will now represent the one-mode matrix formed by the row entities&mdash;people will have ties to each other if they are in the same group, in our example. Here&rsquo;s what it looks like:</p>
<pre><code>Arow
4 x 4 sparse Matrix of class &quot;dgCMatrix&quot;
     Greg Mary Sam Tom
Greg    1    .   1   .
Mary    .    2   1   2
Sam     1    1   3   2
Tom     .    2   2   3
</code></pre>
<p>To get the one-mode matrix formed by the column entities (i.e. the number of people) enter the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Acol</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">A</span>
</span></span></code></pre></div><p>Again, we can use tcrossprod to make this even more efficient:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">Acol</span> <span class="o">&lt;-</span> <span class="nf">tcrossprod</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
</span></span></code></pre></div><p>And the resulting co-membership matrix is as follows:</p>
<pre><code>Mcol
group
group a b c d
a 2 1 1 0
b 1 3 2 2
c 1 2 2 1
d 0 2 1 2
</code></pre>
<p>Although we&rsquo;ve used a very small network for our example, this code is highly extensible to the analysis of larger networks with R.</p>
<h2 id="c1">Analysis of Two Mode Data and Mobility</h2>
<p>Let&rsquo;s work with some actual affiliation data, collected by Dan McFarland on student extracurricular affiliations. It&rsquo;s a longitudinal data set, with 3 waves - 1996, 1997, 1998.  It consists of students (anonymized) and the student organizations in which they are members (e.g. National Honor Society, wrestling team, cheerleading squad, etc.).
What we&rsquo;ll do is to read in the data, explore it, make a few two-to-one mode conversions, and visualize it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Load the &#39;igraph&#39; library</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="s">&#39;igraph&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (1) Read in the data files, NA data objects coded as &#39;na&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">magact96</span> <span class="o">=</span> <span class="nf">read.delim</span><span class="p">(</span><span class="s">&#39;https://solomonmg.github.io/assets/img/mag_act96.txt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="n">na.strings</span> <span class="o">=</span> <span class="s">&#39;na&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">magact97</span> <span class="o">=</span> <span class="nf">read.delim</span><span class="p">(</span><span class="s">&#39;https://solomonmg.github.io/assets/img/mag_act97.txt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="n">na.strings</span> <span class="o">=</span> <span class="s">&#39;na&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">magact98</span> <span class="o">=</span> <span class="nf">read.delim</span><span class="p">(</span><span class="s">&#39;https://solomonmg.github.io/assets/img/mag_act98.txt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="n">na.strings</span> <span class="o">=</span> <span class="s">&#39;na&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>Missing data is coded as &ldquo;na&rdquo; in this data, which is why we gave R the command na.strings = &ldquo;na&rdquo;.</p>
<p>These files consist of four columns of individual-level attributes (ID, gender, grade, race), then a bunch of group membership dummy variables (coded &ldquo;1&rdquo; for membership, &ldquo;0&rdquo; for no membership).  We need to set aside the first four columns (which do not change from year to year).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magattrib</span> <span class="o">=</span> <span class="n">magact96[</span><span class="p">,</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="n">g96</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">magact96[</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="n">]</span><span class="p">);</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g96</span><span class="p">)</span> <span class="o">=</span> <span class="n">magact96</span><span class="o">$</span><span class="n">ID.</span>
</span></span><span class="line"><span class="cl"><span class="n">g97</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">magact97[</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="n">]</span><span class="p">);</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g97</span><span class="p">)</span> <span class="o">=</span> <span class="n">magact97</span><span class="o">$</span><span class="n">ID.</span>
</span></span><span class="line"><span class="cl"><span class="n">g98</span> <span class="o">&lt;-</span> <span class="nf">as.matrix</span><span class="p">(</span><span class="n">magact98[</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="n">]</span><span class="p">);</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g98</span><span class="p">)</span> <span class="o">=</span> <span class="n">magact98</span><span class="o">$</span><span class="n">ID.</span>
</span></span></code></pre></div><p>By using the <code>[,-(1:4)]</code> index, we drop those columns so that we have a square incidence matrix for each year, and then tell R to set the row names of the matrix to the student&rsquo;s ID. Note that we need to keep the &ldquo;.&rdquo; after ID in this dataset (because it&rsquo;s in the name of the variable).
Now we load these two-mode matrices into igraph:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">i96</span> <span class="o">&lt;-</span> <span class="nf">graph.incidence</span><span class="p">(</span><span class="n">g96</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">i97</span> <span class="o">&lt;-</span> <span class="nf">graph.incidence</span><span class="p">(</span><span class="n">g97</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">i98</span> <span class="o">&lt;-</span> <span class="nf">graph.incidence</span><span class="p">(</span><span class="n">g98</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span> <span class="p">)</span>
</span></span></code></pre></div><h3 id="plotting-two-mode-networks">Plotting two-mode networks</h3>
<p>Now, let&rsquo;s plot these graphs. The igraph package has excellent plotting functionality that allows you to assign visual attributes to igraph objects before you plot. The alternative is to pass 20 or so arguments to the <code>plot.igraph()</code> function, which gets really messy.</p>
<p>Let&rsquo;s assign some attributes to our graph. First we set vertex attributes, making sure to make them slightly transparent by altering the gamma, using the <code>rgb(r,g,b,gamma)</code> function to set the color. This makes it much easier to look at a really crowded graph, which might look like a giant hairball otherwise.
You can read up on the RGB color model <a href="http://en.wikipedia.org/wiki/RGB_color_model" target="_blank" rel="noopener">here</a>.</p>
<p>Each node (or &ldquo;vertex&rdquo;) object is accessible by calling <code>V(g)</code>, and you can call (or create) a node attribute by using the <code>$</code> operator so that you call <code>V(g)$attribute</code>. Here&rsquo;s how to set the color attribute for a set of nodes in a graph object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color[1</span><span class="o">:</span><span class="m">1295</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color[1296</span><span class="o">:</span><span class="m">1386</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span>
</span></span></code></pre></div><p>Notice that we index the <code>V(g)$color</code> object by a seemingly arbitrary value, 1295.  This marks the end of the student nodes, and 1296 is the first group node. You can view which nodes are which by typing V(i96). R prints out a list of all the nodes in the graph, and those with a number are obviously different from those that consist of a group name.</p>
<p>Now we&rsquo;ll set some other graph attributes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label</span> <span class="o">&lt;-</span> <span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">name</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label.color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label.cex</span> <span class="o">&lt;-</span> <span class="m">.4</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="m">6</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">frame.color</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
</span></span></code></pre></div><p>You can also set edge attributes. Here we&rsquo;ll make the edges nearly transparent and slightly yellow because there will be so many edges in this graph:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, we&rsquo;ll open a pdf &ldquo;device&rdquo; on which to plot. This is just a connection to a pdf file. Note that the code below will take a minute or two to execute (or longer if you have a pre- Intel dual-core processor).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="s">&#39;i96.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span></code></pre></div><p>Note that we&rsquo;ve used the Fruchterman-Reingold force-directed layout algorithm here.  Generally speaking, the when you have a ton of edges, the Kamada-Kawai layout algorithm works well but, it can get really slow for networks with a lot of nodes. Also, for larger networks, layout.fruchterman.reingold.grid is faster, but can fail to produce a plot with any meaninful pattern if you have too many isolates, as is the case here. Experiment for yourself.
Here&rsquo;s what we get:</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/img/i96.jpg" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>It&rsquo;s oddly reminiscent of a cresent and star, but impossible to read. Now, if you open the <a href="/img/i96.pdf">pdf output</a>, you&rsquo;ll notice that you can zoom in on any part of the graph ad infinitum without losing any resolution. How is that possible in such a small file? It&rsquo;s possible because the pdf device output consists of data based on vectors: lines, polygons, circles, elipses, etc., each specified by a mathematical formula that your pdf program renders when you view it. Regular bitmap or jpeg picture output, on the other hand, consists of a pixel-coordinate mapping of the image in question, which is why you lose resolution when you zoom in on a digital photograph or a plot produced with most other programs.</p>
<p>Let&rsquo;s remove all of the isolates (the cresent), change a few aesthetic features, and replot. First, we&rsquo;ll remove isloates, by deleting all nodes with a degree of 0, meaning that they have zero edges. Then, we&rsquo;ll suppress labels for students and make their nodes smaller and more transparent. Then we&rsquo;ll make the edges more narrow more transparent. Then, we&rsquo;ll replot using various layout algorithms:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">i96</span> <span class="o">&lt;-</span> <span class="nf">delete.vertices</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span> <span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="n">[</span> <span class="nf">degree</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">==</span><span class="m">0</span> <span class="n">]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">label[1</span><span class="o">:</span><span class="m">857</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color[1</span><span class="o">:</span><span class="m">857</span><span class="n">]</span> <span class="o">&lt;-</span>  <span class="nf">rgb</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">size[1</span><span class="o">:</span><span class="m">857</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">width</span> <span class="o">&lt;-</span> <span class="m">.3</span>
</span></span><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">i96</span><span class="p">)</span><span class="o">$</span><span class="n">color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="s">&#39;i96.2.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout.kamada.kawai</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="s">&#39;i96.3.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold.grid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="s">&#39;i96.4.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">i96</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span></code></pre></div><p>I personally prefer the Fruchterman-Reingold layout in this case. The nice thing about this layout is that it really emphasizes centrality&ndash;the nodes that are most central are nearly always placed in the middle of the plot. Here&rsquo;s what it looks like:</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/img/i962.jpg" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Very pretty, but you can&rsquo;t see which groups are which at this resolution. Zoom assets/in on the <a href="/img/samplepdf.pdf">pdf output</a>, and you can see things pretty clearly.</p>
<h3 id="two-mode-to-one-mode-data-transformation">Two mode to one mode data transformation</h3>
<p>We&rsquo;ve emphasized groups in this visualization so much, that we might want to just create a network consisting of group co-membership. First we need to create a new network object. We&rsquo;ll do that the same way for this network as for our example at the top of this page:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">g96e</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">g96</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">g96</span>
</span></span><span class="line"><span class="cl"><span class="n">g97e</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">g97</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">g97</span>
</span></span><span class="line"><span class="cl"><span class="n">g98e</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">g98</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">g98</span>
</span></span><span class="line"><span class="cl"><span class="n">i96e</span> <span class="o">&lt;-</span> <span class="nf">graph.adjacency</span><span class="p">(</span><span class="n">g96e</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;undirected&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>Now we need to tansform the graph so that multiple edges become an attribute ( <code>E(g)$weight</code> ) of each unique edge:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span> <span class="o">&lt;-</span> <span class="nf">count.multiple</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">i96e</span> <span class="o">&lt;-</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span>
</span></span></code></pre></div><p>Now we&rsquo;ll set the other plotting parameters as we did above:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Set vertex attributes</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">label</span> <span class="o">&lt;-</span> <span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">name</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">label.color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">,</span><span class="m">.8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">label.cex</span> <span class="o">&lt;-</span> <span class="m">.6</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="m">6</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">frame.color</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set edge gamma according to edge weight</span>
</span></span><span class="line"><span class="cl"><span class="n">egam</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="nf">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="m">+.3</span><span class="p">)</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="nf">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="p">)</span><span class="m">+.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">i96e</span><span class="p">)</span><span class="o">$</span><span class="n">color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="n">egam</span><span class="p">)</span>
</span></span></code></pre></div><p>We set edge gamma as a function of how many edges exist between two nodes, or in this case, how many students each group has in common. For illustrative purposes, let&rsquo;s compare how the Kamada-Kawai and Fruchterman-Reingold algorithms render this graph:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="s">&#39;i96e.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">i96e</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&#39;layout.kamada.kawai&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout.kamada.kawai</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">i96e</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&#39;layout.fruchterman.reingold&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout.fruchterman.reingold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span></code></pre></div><p>I like the Kamada-Kawai layout for this graph, because the center of the graph is too busy otherwise. And here&rsquo;s what the resulting plot looks like:
















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/img/i96e-kk.jpeg" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>You can check out the difference between each layout yourself. Here&rsquo;s what the <a href="/img/i96e.pdf">assets/pdf output looks like</a>.  Page 1 shows the Kamada-Kawai layout and page 2 shows the Fruchterman Reingold layout.</p>
<h3 id="group-overlap-networks-and-plots">Group overlap networks and plots</h3>
<p>Now we might also be interested in the percent overlap between groups. Note that this will be a directed graph, because the percent overlap will not be symmetric across groups&ndash;for example, it may be that 3/4 of Spanish NHS members are in NHS, but only 1/8 of NHS members are in the Spanish NHS. We&rsquo;ll create this graph for all years in our data (though we could do it for one year only).
First we&rsquo;ll need to create a percent overlap graph. We start by dividing each row by the diagonal (this is really easy in R):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ol96</span> <span class="o">&lt;-</span> <span class="n">g96e</span><span class="o">/</span><span class="nf">diag</span><span class="p">(</span><span class="n">g96e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ol97</span> <span class="o">&lt;-</span> <span class="n">g97e</span><span class="o">/</span><span class="nf">diag</span><span class="p">(</span><span class="n">g97e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ol98</span> <span class="o">&lt;-</span> <span class="n">g98e</span><span class="o">/</span><span class="nf">diag</span><span class="p">(</span><span class="n">g98e</span><span class="p">)</span>
</span></span></code></pre></div><p>Next, sum the matricies and set any NA cells (caused by dividing by zero in the step above) to zero:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magall</span> <span class="o">&lt;-</span> <span class="n">ol96</span> <span class="o">+</span> <span class="n">ol97</span> <span class="o">+</span> <span class="n">ol98</span>
</span></span><span class="line"><span class="cl"><span class="n">magall</span><span class="nf">[is.na</span><span class="p">(</span><span class="n">magall</span><span class="p">)</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
</span></span></code></pre></div><p>Note that magall now consists of a percent overlap matrix, but because we&rsquo;ve summed over 3 years, the maximun is now 3 instead of 1.
Let&rsquo;s compute average club size, by taking the mean across each value in each diagonal:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magdiag</span> <span class="o">&lt;-</span> <span class="nf">apply</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="nf">diag</span><span class="p">(</span><span class="n">g96e</span><span class="p">),</span> <span class="nf">diag</span><span class="p">(</span><span class="n">g97e</span><span class="p">),</span> <span class="nf">diag</span><span class="p">(</span><span class="n">g98e</span><span class="p">)),</span> <span class="m">1</span><span class="p">,</span> <span class="n">mean</span> <span class="p">)</span>
</span></span></code></pre></div><p>Finally, we&rsquo;ll generate centrality measures for magall. When we create the igraph object from our matrix, we need to set weighted=T because otherwise igraph dichotomizes edges at 1. This can distort our centrality measures because now edges represent  more than binary connections&ndash;they represent the percent of membership overlap.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magallg</span> <span class="o">&lt;-</span> <span class="nf">graph.adjacency</span><span class="p">(</span><span class="n">magall</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Degree</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span><span class="o">$</span><span class="n">degree</span> <span class="o">&lt;-</span> <span class="nf">degree</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Betweenness centrality</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span><span class="o">$</span><span class="n">btwcnt</span> <span class="o">&lt;-</span> <span class="nf">betweenness</span><span class="p">(</span><span class="n">magallg</span><span class="p">)</span>
</span></span></code></pre></div><p>Before we plot this, we should probably filter some of the edges, otherwise our graph will probably be too busy to make sense of visually.  Take a look at the distribution of connection strength by plotting the density of the magall matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="nf">density</span><span class="p">(</span><span class="n">magall</span><span class="p">))</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/img/densitymagall.jpeg" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Nearly all of the edge weights are below 1&ndash;or in other words, the percent overlap for most clubs is less than 1/3. Let&rsquo;s filter at 1, so that an edge will consists of group overlap of more than 1/3 of the group&rsquo;s members in question.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magallgt1</span> <span class="o">&lt;-</span> <span class="n">magall</span>
</span></span><span class="line"><span class="cl"><span class="n">magallgt1[magallgt1</span><span class="o">&lt;</span><span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="n">magallggt1</span> <span class="o">&lt;-</span> <span class="nf">graph.adjacency</span><span class="p">(</span><span class="n">magallgt1</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Removes loops:</span>
</span></span><span class="line"><span class="cl"><span class="n">magallggt1</span> <span class="o">&lt;-</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">,</span> <span class="n">remove.multiple</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">remove.loops</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><p>Before we do anything else, we&rsquo;ll create a custom layout based on Fruchterman.-Ringold wherein we adjust the coordates by hand using the tkplot gui tool to make sure all of the labels are visible. This is very useful if you want to create a really sharp-looking network visualization for publication.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magallggt1</span><span class="o">$</span><span class="n">layout</span> <span class="o">&lt;-</span> <span class="nf">layout.fruchterman.reingold</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label</span> <span class="o">&lt;-</span> <span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">name</span>
</span></span><span class="line"><span class="cl"><span class="nf">tkplot</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span>
</span></span></code></pre></div><p>Let the plot load, then maximize the window, and select to View -&gt; Fit to Screen so that you get maximum resolution for this large graph. Now hand-place the nodes, making sure no labels overlap:
















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/img/tkplotscreenshot.png" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>Pay special attention to whether the labels overlap (or might overlap if the font was bigger) along the vertical. Save the layout coordinates to the graph object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magallggt1</span><span class="o">$</span><span class="n">layout</span> <span class="o">&lt;-</span> <span class="nf">tkplot.getcoords</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
</span></span></code></pre></div><p>We use &ldquo;1&rdquo; here because only if this was the first tkplot object you called. If you called tkplot a few times, use the last plot object. You can tell which object is visible because at the top of the tkplot interface, you&rsquo;ll see something like &ldquo;Graph plot 1&rdquo; or in the case of my screenshot above &ldquo;Graph plot 7&rdquo; (it was the seventh time I called tkplot).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="c1"># Set vertex attributes</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label</span> <span class="o">&lt;-</span> <span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">name</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label.color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">.2</span><span class="p">,</span><span class="m">.6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">size</span> <span class="o">&lt;-</span> <span class="m">6</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">frame.color</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
</span></span><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set edge attributes</span>
</span></span><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">arrow.size</span> <span class="o">&lt;-</span> <span class="m">.3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set edge gamma according to edge weight</span>
</span></span><span class="line"><span class="cl"><span class="n">egam</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="nf">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="m">+.1</span><span class="p">)</span><span class="o">/</span><span class="nf">max</span><span class="p">(</span><span class="nf">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">weight</span><span class="m">+.1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">E</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">color</span> <span class="o">&lt;-</span> <span class="nf">rgb</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.5</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="n">egam</span><span class="p">)</span>
</span></span></code></pre></div><p>One thing that we can do with this graph is to set label size as a function of degree, which adds a &ldquo;tag-cloud&rdquo;-like element to the visualization:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">label.cex</span> <span class="o">&lt;-</span> <span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">degree</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="nf">V</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span><span class="o">$</span><span class="n">degree</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">)</span><span class="o">+</span> <span class="m">.3</span>
</span></span><span class="line"><span class="cl"><span class="c1">#note, unfortunately one must play with the formula above to get the</span>
</span></span><span class="line"><span class="cl"><span class="c1">#ratio just right</span>
</span></span></code></pre></div><p>Let&rsquo;s plot the results:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">pdf</span><span class="p">(</span><span class="s">&#39;magallggt1customlayout.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">plot</span><span class="p">(</span><span class="n">magallggt1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">dev.off</span><span class="p">()</span>
</span></span></code></pre></div><p>Note that we used the custom layout, which because we made part of the igraph object magallggt1, we did not need to specify in plot command.
assets/Here&rsquo;s the <a href="/img/magallggt1custom.pdf">pdf output</a>, and here&rsquo;s what it looks like:</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img src="/img/magallggt1custom.png" alt="" loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>This visualization reveals much more information about our network than our cresent-star visualization.</p>
<h3 id="mobility-markov-and-transition-probabilities">Mobility, Markov, and Transition Probabilities</h3>
<p>In order to shed light on how people flow through these groups, we&rsquo;ll compute transition probabilities. These transition probabilities are more generally referred to as Markov chains.</p>
<p>First we&rsquo;ll create a new matrix that multiplies 1996 magnet with 1997 magnet so you see the number of students moving from 1996 membership to 1997 memberships.</p>
<p>Before we actually do this, we need to do some data munging to make sure that the rows and columns for g96 and g97 are the same. We&rsquo;ll use the match() function for this.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># First, let&#39;s get an idea of how many column-names (activities) and row</span>
</span></span><span class="line"><span class="cl"><span class="c1"># names (student ids) are in common between the two years:</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">cnames</span> <span class="o">=</span> <span class="nf">intersect</span><span class="p">(</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g96</span><span class="p">),</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">rnames</span> <span class="o">=</span> <span class="nf">intersect</span><span class="p">(</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g96</span><span class="p">),</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g97</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># Great, there are a lot of names in common. Now we</span>
</span></span><span class="line"><span class="cl"><span class="c1"># need to make sure we are only using the rows</span>
</span></span><span class="line"><span class="cl"><span class="c1"># and columns of each matrix that contain entries used in</span>
</span></span><span class="line"><span class="cl"><span class="c1"># both years. We also need to make sure that the columns and</span>
</span></span><span class="line"><span class="cl"><span class="c1"># rows are in the same order.</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># In order to accomplish this we are going to exploit R&#39;s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># indexing capabilities. We are going to have R &#34;rebuild&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># each matrix according to the order of rnames and cnames.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># We&#39;ll use the match() function to accomplish this.</span>
</span></span><span class="line"><span class="cl"><span class="n">g96matched</span> <span class="o">=</span> <span class="n">g96[</span> <span class="nf">match</span><span class="p">(</span><span class="n">rnames</span><span class="p">,</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g96</span><span class="p">)),</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g96</span><span class="p">))</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="n">g97matched</span> <span class="o">=</span> <span class="n">g97[</span> <span class="nf">match</span><span class="p">(</span><span class="n">rnames</span><span class="p">,</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g97</span><span class="p">)),</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97</span><span class="p">))</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># We need to do the same thing for the diagonal of the matrix g96e, which is</span>
</span></span><span class="line"><span class="cl"><span class="c1"># our co-membership/affiliation matrix computed above:</span>
</span></span><span class="line"><span class="cl"><span class="n">mag96diagmatched</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span> <span class="n">g96e[</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g96e</span><span class="p">)),</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g96e</span><span class="p">))</span> <span class="n">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># Now let&#39;s check to make sure things worked correctly:</span>
</span></span><span class="line"><span class="cl"><span class="nf">which</span><span class="p">(</span><span class="nf">row.names</span><span class="p">(</span><span class="n">g96matched</span><span class="p">)</span> <span class="o">!=</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g97matched</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">which</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">g96matched</span><span class="p">)</span> <span class="o">!=</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97matched</span><span class="p">))</span>
</span></span></code></pre></div><p>Now that these are effectively matricies, we can multiply to get the transition probability matrix:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mag96_97</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">g96matched</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">g97matched</span>
</span></span></code></pre></div><p>Let&rsquo;s munge the 97 and 98 data and repeat:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cnames</span> <span class="o">=</span> <span class="nf">intersect</span><span class="p">(</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97</span><span class="p">),</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g98</span><span class="p">)</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">rnames</span> <span class="o">=</span> <span class="nf">intersect</span><span class="p">(</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g97</span><span class="p">),</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g98</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">g97matched</span> <span class="o">=</span> <span class="n">g97[</span> <span class="nf">match</span><span class="p">(</span><span class="n">rnames</span><span class="p">,</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g97</span><span class="p">)),</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97</span><span class="p">))</span> <span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="n">g98matched</span> <span class="o">=</span> <span class="n">g98[</span> <span class="nf">match</span><span class="p">(</span><span class="n">rnames</span><span class="p">,</span> <span class="nf">row.names</span><span class="p">(</span><span class="n">g98</span><span class="p">)),</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g98</span><span class="p">))</span> <span class="n">]</span>
</span></span></code></pre></div><p>And again for the 97-98 transition:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mag97_98</span> <span class="o">=</span> <span class="nf">t</span><span class="p">(</span><span class="n">g97matched</span><span class="p">)</span> <span class="o">%*%</span> <span class="n">g98matched</span>
</span></span></code></pre></div><p>Now we need to get the group-level membership matrix diagonal, ordered by the current set of columns.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mag96diagmatched</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span> <span class="n">g96e[</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g96e</span><span class="p">)),</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g96e</span><span class="p">))</span> <span class="n">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mag97diagmatched</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span> <span class="n">g97e[</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97e</span><span class="p">)),</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g97e</span><span class="p">))</span> <span class="n">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="n">mag98diagmatched</span> <span class="o">=</span> <span class="nf">diag</span><span class="p">(</span> <span class="n">g98e[</span> <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g98e</span><span class="p">)),</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">match</span><span class="p">(</span><span class="n">cnames</span><span class="p">,</span> <span class="nf">colnames</span><span class="p">(</span><span class="n">g98e</span><span class="p">))</span> <span class="n">]</span> <span class="p">)</span>
</span></span></code></pre></div><p>And finally we can create the transition probability matrix! Divide magmob96_97 by mag96diagmatched in to get the transition probability matrix (Markov chain):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">magmob96_97</span> <span class="o">=</span> <span class="n">mag96_97</span><span class="o">/</span><span class="n">mag96diagmatched</span> 
</span></span><span class="line"><span class="cl"><span class="n">magmob97_98</span> <span class="o">=</span> <span class="n">mag97_98</span><span class="o">/</span><span class="n">mag97diagmatched</span>
</span></span></code></pre></div><p>Now add the matrices and divide by 2:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">mobility_all</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">magmob96_97</span> <span class="o">+</span> <span class="n">magmob97_98</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
</span></span></code></pre></div><p>Now plot as with the event-overlap graphs!</p>

    </div>

    







<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fsolmessing.netlify.app%2Fpost%2Fworking-with-bipartite-affiliation-network-data-in-r%2F&amp;text=Working&#43;with&#43;Bipartite%2FAffiliation&#43;Network&#43;Data&#43;in&#43;R" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fsolmessing.netlify.app%2Fpost%2Fworking-with-bipartite-affiliation-network-data-in-r%2F&amp;t=Working&#43;with&#43;Bipartite%2FAffiliation&#43;Network&#43;Data&#43;in&#43;R" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Working%20with%20Bipartite%2FAffiliation%20Network%20Data%20in%20R&amp;body=https%3A%2F%2Fsolmessing.netlify.app%2Fpost%2Fworking-with-bipartite-affiliation-network-data-in-r%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fsolmessing.netlify.app%2Fpost%2Fworking-with-bipartite-affiliation-network-data-in-r%2F&amp;title=Working&#43;with&#43;Bipartite%2FAffiliation&#43;Network&#43;Data&#43;in&#43;R" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=Working&#43;with&#43;Bipartite%2FAffiliation&#43;Network&#43;Data&#43;in&#43;R%20https%3A%2F%2Fsolmessing.netlify.app%2Fpost%2Fworking-with-bipartite-affiliation-network-data-in-r%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fsolmessing.netlify.app%2Fpost%2Fworking-with-bipartite-affiliation-network-data-in-r%2F&amp;title=Working&#43;with&#43;Bipartite%2FAffiliation&#43;Network&#43;Data&#43;in&#43;R" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  
    




  
















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    ©2023 Sol Messing. This work is licensed under XX
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Hugo Blox Builder</a> — the free, <a href="https://github.com/HugoBlox/hugo-blox-builder" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.d613345003d21781ec611233eea95b85.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  

















<script id="page-data" type="application/json">{"use_headroom":true}</script>


  <script src="/js/wowchemy-headroom.b95a7e109243f29d04930ae8cb49a756.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.69fc52a6dc16aaf1a452cfbb36466dac.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.9c0e895144aef5a693008b5c5d450147.js" type="module"></script>


















</body>
</html>
